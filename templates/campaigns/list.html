{% extends "base.html" %}

{% block title %}Campaigns - Donation Platform{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <!-- Header Section -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold">Active Campaigns</h1>
            <p class="lead">Support these impactful campaigns making a difference worldwide</p>
        </div>
    </div>
    
    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-lg-8 mx-auto">
            <div class="card filter-section">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" class="form-control search-input" placeholder="Search campaigns..." id="campaign-search">
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="category-filter">
                                <option value="all" {{ 'selected' if current_category == 'all' }}>All Categories</option>
                                <option value="education" {{ 'selected' if current_category == 'education' }}>Education</option>
                                <option value="health" {{ 'selected' if current_category == 'health' }}>Health</option>
                                <option value="environment" {{ 'selected' if current_category == 'environment' }}>Environment</option>
                                <option value="poverty" {{ 'selected' if current_category == 'poverty' }}>Poverty</option>
                                <option value="disaster" {{ 'selected' if current_category == 'disaster' }}>Disaster Relief</option>
                                <option value="animals" {{ 'selected' if current_category == 'animals' }}>Animals</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" onclick="applyFilters()">
                                <i class="fas fa-filter"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Campaigns Grid -->
    <div class="row" id="campaigns-container">
        {% for campaign in campaigns %}
        <div class="col-lg-4 col-md-6 mb-4 searchable-item" data-category="{{ campaign.category.lower() }}">
            <div class="card campaign-card h-100">
                {% if campaign.banner_image %}
                <img src="{{ campaign.banner_image }}" class="card-img-top" alt="{{ campaign.title }}" style="height: 250px; object-fit: cover;">
                {% else %}
                <div class="card-img-top campaign-placeholder">
                    <svg width="100%" height="250" viewBox="0 0 400 250" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="400" height="250" fill="#e9ecef"/>
                        <circle cx="200" cy="125" r="40" fill="#6c757d"/>
                        <text x="200" y="185" text-anchor="middle" fill="#6c757d" font-size="14">{{ campaign.category }}</text>
                    </svg>
                </div>
                {% endif %}
                
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <span class="badge bg-primary">{{ campaign.category }}</span>
                        <small class="text-muted">{{ campaign.created_at.strftime('%b %d') }}</small>
                    </div>
                    
                    <h5 class="card-title">{{ campaign.title }}</h5>
                    <p class="card-text flex-grow-1">{{ campaign.description[:120] }}{% if campaign.description|length > 120 %}...{% endif %}</p>
                    
                    <!-- Progress Section -->
                    <div class="campaign-progress mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="text-muted">Progress</small>
                            <small class="text-muted">{{ "%.0f"|format(campaign.progress_percentage) }}%</small>
                        </div>
                        <div class="progress mb-2">
                            <div class="progress-bar" style="width: '{{ campaign.progress_percentage }}%'" role="progressbar"></div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong class="text-success">${{ "%.0f"|format(campaign.raised_amount) }}</strong>
                                <small class="text-muted">raised</small>
                            </div>
                            <div class="text-end">
                                <strong class="text-primary">${{ "%.0f"|format(campaign.goal_amount) }}</strong>
                                <small class="text-muted">goal</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Organization Info -->
                    <div class="d-flex align-items-center mb-3">
                        <div class="org-avatar me-2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect width="24" height="24" fill="#dee2e6" rx="12"/>
                                <text x="12" y="16" text-anchor="middle" fill="#6c757d" font-size="10">ORG</text>
                            </svg>
                        </div>
                        <small class="text-muted">by {{ campaign.get_organisation().name if campaign.get_organisation() else 'Organization' }}</small>
                    </div>
                </div>
                
                <div class="card-footer">
                    <div class="d-grid gap-2 d-md-flex">
                        <a href="{{ url_for('campaign.detail', id=campaign._id) }}" class="btn btn-outline-primary flex-fill">
                            Learn More
                        </a>
                        <a href="{{ url_for('donation.donate', campaign_id=campaign._id) }}" class="btn btn-primary flex-fill">
                            <i class="fas fa-heart me-1"></i>Donate
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Load More Button -->
    {% if has_next %}
    <div class="text-center mt-4">
        <button class="btn btn-outline-primary load-more-btn" 
                data-container="#campaigns-container" 
                data-url="{{ url_for('campaign.list') }}" 
                data-page="{{ page }}">
            Load More Campaigns
        </button>
    </div>
    {% endif %}
    
    <!-- Empty State -->
    {% if not campaigns %}
    <div class="text-center py-5">
        <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="30" fill="#e9ecef"/>
            <text x="50" y="55" text-anchor="middle" fill="#6c757d" font-size="12">No Campaigns</text>
        </svg>
        <h4 class="mt-3">No Campaigns Found</h4>
        <p class="text-muted">Try adjusting your search criteria or check back later for new campaigns.</p>
    </div>
    {% endif %}
</div>

<script>
function applyFilters() {
    const searchTerm = document.getElementById('campaign-search').value.toLowerCase();
    const selectedCategory = document.getElementById('category-filter').value;
    const campaigns = document.querySelectorAll('.searchable-item');
    
    campaigns.forEach(campaign => {
        const text = campaign.textContent.toLowerCase();
        const category = campaign.dataset.category;
        
        const matchesSearch = text.includes(searchTerm);
        const matchesCategory = selectedCategory === 'all' || category === selectedCategory;
        
        campaign.style.display = matchesSearch && matchesCategory ? 'block' : 'none';
    });
}

// Auto-apply filters on search input
document.getElementById('campaign-search').addEventListener('input', applyFilters);
document.getElementById('category-filter').addEventListener('change', applyFilters);
</script>

<style>
.campaign-progress {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
}

[data-theme="dark"] .campaign-progress {
    background-color: #2c2c2c;
}

.org-avatar {
    flex-shrink: 0;
}
</style>
{% endblock %}
