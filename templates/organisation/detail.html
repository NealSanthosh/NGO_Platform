{% extends "base.html" %}

{% block title %}{{ organisation.name }} - Donation Platform{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <!-- Organization Header -->
    <div class="row mb-5">
        <div class="col-12">
            {% if organisation.banner_image %}
            <div class="org-banner mb-4">
                <img src="{{ organisation.banner_image }}" class="w-100" alt="{{ organisation.name }}" style="height: 300px; object-fit: cover; border-radius: 12px;">
            </div>
            {% endif %}
            
            <div class="d-flex align-items-center mb-4">
                {% if organisation.logo_image %}
                <img src="{{ organisation.logo_image }}" class="org-detail-logo me-4" alt="{{ organisation.name }}">
                {% else %}
                <div class="org-detail-logo-placeholder me-4">
                    <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="100" height="100" fill="#dee2e6" rx="50"/>
                        <text x="50" y="60" text-anchor="middle" fill="#6c757d" font-size="20">{{ organisation.name[0] }}</text>
                    </svg>
                </div>
                {% endif %}
                
                <div>
                    <h1 class="display-5 fw-bold mb-2">{{ organisation.name }}</h1>
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-success me-3">Verified Organization</span>
                        {% if organisation.website %}
                        <a href="{{ organisation.website }}" target="_blank" class="text-muted">
                            <i class="fas fa-external-link-alt me-1"></i>Visit Website
                        </a>
                        {% endif %}
                    </div>
                    <p class="text-muted mb-0">
                        <i class="fas fa-calendar me-1"></i>
                        Member since {{ organisation.created_at.strftime('%B %Y') }}
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Organization Stats -->
    <div class="row mb-5">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card text-center">
                <div class="card-body">
                    <i class="fas fa-dollar-sign fa-2x text-success mb-2"></i>
                    <h4 class="fw-bold">${{ "%.0f"|format(organisation.total_donations) }}</h4>
                    <p class="text-muted mb-0">Total Raised</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card text-center">
                <div class="card-body">
                    <i class="fas fa-heart fa-2x text-primary mb-2"></i>
                    <h4 class="fw-bold">{{ campaigns|length }}</h4>
                    <p class="text-muted mb-0">Active Campaigns</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card text-center">
                <div class="card-body">
                    <i class="fas fa-users fa-2x text-warning mb-2"></i>
                    <h4 class="fw-bold">{{ campaigns|sum(attribute='progress_percentage')|int }}+</h4>
                    <p class="text-muted mb-0">Lives Impacted</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card text-center">
                <div class="card-body">
                    <i class="fas fa-award fa-2x text-danger mb-2"></i>
                    <h4 class="fw-bold">A+</h4>
                    <p class="text-muted mb-0">Trust Rating</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- About Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="mb-0">About {{ organisation.name }}</h4>
                </div>
                <div class="card-body">
                    <p>{{ organisation.description }}</p>
                    
                    {% if organisation.mission %}
                    <h6 class="fw-bold mt-4">Our Mission</h6>
                    <p class="text-muted">{{ organisation.mission }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Active Campaigns -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Active Campaigns</h4>
                    <span class="badge bg-primary">{{ campaigns|length }} campaigns</span>
                </div>
                <div class="card-body">
                    {% if campaigns %}
                    <div class="row">
                        {% for campaign in campaigns %}
                        <div class="col-md-6 mb-4">
                            <div class="card campaign-card h-100">
                                {% if campaign.banner_image %}
                                <img src="{{ campaign.banner_image }}" class="card-img-top" alt="{{ campaign.title }}" style="height: 150px; object-fit: cover;">
                                {% else %}
                                <div class="card-img-top campaign-placeholder" style="height: 150px;">
                                    <svg width="100%" height="150" viewBox="0 0 300 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect width="300" height="150" fill="#e9ecef"/>
                                        <circle cx="150" cy="75" r="25" fill="#6c757d"/>
                                        <text x="150" y="120" text-anchor="middle" fill="#6c757d" font-size="10">Campaign</text>
                                    </svg>
                                </div>
                                {% endif %}
                                
                                <div class="card-body">
                                    <h6 class="card-title">{{ campaign.title }}</h6>
                                    <p class="card-text small">{{ campaign.description[:80] }}...</p>
                                    
                                    <div class="progress mb-2">
                                        <div class="progress-bar" style="width: '{{ campaign.progress_percentage }}%'"></div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between small text-muted">
                                        <span>${{ "%.0f"|format(campaign.raised_amount) }} raised</span>
                                        <span>{{ "%.0f"|format(campaign.progress_percentage) }}%</span>
                                    </div>
                                </div>
                                
                                <div class="card-footer">
                                    <a href="{{ url_for('campaign.detail', id=campaign._id) }}" class="btn btn-primary btn-sm w-100">View Campaign</a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-heart fa-3x text-muted mb-3"></i>
                        <h6>No Active Campaigns</h6>
                        <p class="text-muted">This organization doesn't have any active campaigns at the moment.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Contact Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Contact Information</h5>
                </div>
                <div class="card-body">
                    {% if organisation.phone %}
                    <p class="mb-2">
                        <i class="fas fa-phone text-primary me-2"></i>
                        <a href="tel:{{ organisation.phone }}">{{ organisation.phone }}</a>
                    </p>
                    {% endif %}
                    
                    {% if organisation.address %}
                    <p class="mb-2">
                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                        {{ organisation.address }}
                    </p>
                    {% endif %}
                    
                    {% if organisation.website %}
                    <p class="mb-2">
                        <i class="fas fa-globe text-primary me-2"></i>
                        <a href="{{ organisation.website }}" target="_blank">Visit Website</a>
                    </p>
                    {% endif %}
                    
                    {% if organisation.registration_number %}
                    <p class="mb-0">
                        <i class="fas fa-certificate text-primary me-2"></i>
                        Reg: {{ organisation.registration_number }}
                    </p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Quick Donate -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Support This Organization</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Make a direct impact by supporting this organization's mission.</p>
                    
                    {% if campaigns %}
                    <div class="mb-3">
                        <label for="campaign-select" class="form-label small">Choose a campaign:</label>
                        <select class="form-select form-select-sm" id="campaign-select">
                            {% for campaign in campaigns %}
                            <option value="{{ campaign._id }}">{{ campaign.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <button class="btn btn-success w-100" onclick="donateToSelected()">
                        <i class="fas fa-heart me-1"></i>Donate Now
                    </button>
                    {% else %}
                    <p class="text-muted small">No active campaigns available for donation at this time.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.org-detail-logo {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 50%;
    border: 3px solid #dee2e6;
}

.org-detail-logo-placeholder {
    width: 100px;
    height: 100px;
}

.stat-card {
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
}
</style>

<script>
function donateToSelected() {
    const campaignSelect = document.getElementById('campaign-select');
    if (campaignSelect && campaignSelect.value) {
        window.location.href = `/donate/${campaignSelect.value}`;
    }
}
</script>
{% endblock %}
